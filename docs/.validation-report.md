# API Documentation Validation Report

**Date**: 2026-02-11
**Validator**: cross-validator agent
**Source of Truth**: `/mnt/projects/caamp/src/index.ts` (v0.1.0)

## Summary

| Check | Result | Details |
|-------|--------|---------|
| API Reference completeness | 82/82 symbols documented | **PASS** |
| Integration Doc import surface | 82/82 symbols listed | **PASS** |
| Signature accuracy | 9/10 checked correct | **FAIL** (1 mismatch) |
| Cross-consistency | **FAIL** | 2 issues found |
| CLEO bash function coverage | **PASS** | All spot-checked functions mapped |

**Overall**: FAIL -- 3 issues require correction before both documents are fully accurate.

---

## Detailed Findings

### Check 1: API Reference Completeness

**Source**: `src/index.ts` exports 25 types + 56 functions + 1 class = 82 named exports.
**API-REFERENCE.md**: Documents 25 types + 56 functions + 1 class = 82 named exports.

**Result**: PASS -- 100% coverage. Every exported symbol from `src/index.ts` appears in the API Reference with full documentation.

**Not-exported internal symbols correctly omitted from docs**:
- `resetRegistry()` (providers.ts -- testing utility)
- `installToCanonical()` (skills/installer.ts -- internal step)
- `detectProjectProvider()` (detection.ts -- singular, internal)
- `discoverSkillsMulti()` (discovery.ts -- multi-dir variant)
- `generateSkillsSection()` (templates.ts -- internal helper)
- `getInstructFile()` (templates.ts -- trivial wrapper)

No missing or extra symbols found.

---

### Check 2: Signature Accuracy

10 key functions compared between API-REFERENCE.md signatures and actual TypeScript source:

| # | Function | Doc Signature | Source Signature | Match |
|---|----------|---------------|------------------|-------|
| 1 | `getAllProviders` | `() => Provider[]` | `(): Provider[]` | YES |
| 2 | `detectAllProviders` | `() => DetectionResult[]` | `(): DetectionResult[]` | YES |
| 3 | `installMcpServer` | `(provider, serverName, config, scope?, projectDir?) => Promise<InstallResult>` | `(provider: Provider, serverName: string, config: McpServerConfig, scope: "project" \| "global" = "project", projectDir?: string): Promise<InstallResult>` | YES |
| 4 | `listMcpServers` | `(provider, scope, projectDir?) => Promise<McpServerEntry[]>` | `(provider: Provider, scope: "project" \| "global", projectDir?: string): Promise<McpServerEntry[]>` | YES |
| 5 | `removeMcpServer` | `(provider, serverName, scope, projectDir?) => Promise<boolean>` | `(provider: Provider, serverName: string, scope: "project" \| "global", projectDir?: string): Promise<boolean>` | YES |
| 6 | `installSkill` | `(sourcePath, skillName, providers, isGlobal, projectDir?) => Promise<SkillInstallResult>` | `(sourcePath: string, skillName: string, providers: Provider[], isGlobal: boolean, projectDir?: string): Promise<SkillInstallResult>` | YES |
| 7 | `validateSkill` | `(filePath: string) => Promise<ValidationResult>` | `(filePath: string): Promise<ValidationResult>` | YES |
| 8 | `readConfig` | `(filePath, format) => Promise<Record<string, unknown>>` | `(filePath: string, format: ConfigFormat): Promise<Record<string, unknown>>` | YES |
| 9 | `removeConfig` | `(filePath, format, key, serverName) => Promise<boolean>` | `(filePath: string, format: ConfigFormat, key: string, serverName: string): Promise<boolean>` | YES |
| 10 | `inject` | `(filePath, content) => Promise<"created" \| "added" \| "updated">` | `(filePath: string, content: string): Promise<"created" \| "added" \| "updated">` | YES |

**All 10 function signatures match.** However, there is a type-level issue with MarketplaceClient (see Check 5).

**Result**: 10/10 function signatures correct. PASS for the 10 checked functions.

---

### Check 3: CLEO Integration Completeness

**Complete Import Surface verification**:

The integration doc's "Complete Import Surface" block lists all 82 symbols from `src/index.ts`:
- 25 types: All match `src/index.ts` type exports
- 56 functions: All match `src/index.ts` function exports
- 1 class (`MarketplaceClient`): Matches

**Migration table CAAMP references verified**:
- Every CAAMP function referenced in migration tables (Sections 1-9) exists in `src/index.ts` exports
- No phantom CAAMP symbols referenced

**Result**: PASS

---

### Check 4: CLEO Bash Function Coverage

Spot-checked 4 lib files against the integration doc's migration tables:

#### lib/agent-registry.sh (27 functions)

All 27 functions found in source match the 27 listed in integration doc Section 1:
`ar_load_registry`, `_ar_ensure_loaded`, `ar_list_agents`, `ar_list_by_tier`, `ar_list_by_instruction_file`, `ar_get_agent`, `ar_get_field`, `ar_agent_exists`, `ar_get_global_dir`, `ar_get_project_dir`, `ar_get_instruction_file`, `ar_get_global_instruction_path`, `ar_get_project_instruction_path`, `ar_get_global_skills_dir`, `ar_get_project_skills_dir`, `ar_is_installed`, `ar_list_installed`, `ar_list_installed_by_tier`, `ar_get_display_name`, `ar_get_vendor`, `ar_get_priority`, `ar_get_status`, `ar_is_agent_skills_compatible`, `ar_get_instruction_files`, `ar_get_registry_json`, `ar_get_agent_summary`, `ar_list_agents_json`

**Result**: 27/27 -- PASS

#### lib/mcp-config.sh (28 unique functions in source)

Source grep found 28 function definitions. The integration doc lists 30 entries (rows 55-84), but two entries are duplicates of `mcp_backup_external_file` (rows 75 and 84). After dedup, 29 unique entries. However, `mcp_remove_config` is listed in the integration doc (row 83) but does NOT exist in the actual bash source file -- grep for `mcp_remove_config` returns no matches.

**Finding**: `mcp_remove_config` (row 83 in integration doc) does not exist in `lib/mcp-config.sh`. The actual removal is likely handled within `mcp_write_config` or another function. This is a minor inaccuracy in the integration doc.

**Result**: 28/29 unique entries verified. 1 phantom function (`mcp_remove_config`). Minor FAIL.

#### lib/injection-registry.sh (constants only, no functions)

Source contains 8 constants/declarations as documented:
`INJECTION_TARGETS`, `INJECTION_MARKER_START`, `INJECTION_MARKER_END`, `INJECTION_VERSION_PATTERN`, `INJECTION_TEMPLATE_MAIN`, `INJECTION_TEMPLATE_DIR`, `INJECTION_HEADERS`, `INJECTION_VALIDATION_KEYS`

**Result**: 8/8 -- PASS

#### lib/injection.sh (6 functions)

Source grep found 6 functions matching the integration doc:
`injection_update`, `injection_check`, `injection_check_all`, `injection_apply`, `injection_update_all`, `injection_get_summary`

**Result**: 6/6 -- PASS

---

### Check 5: Consistency Between Documents

#### Issue 1: `MarketplaceResult` vs `MarketplaceSkill` type mismatch (SIGNIFICANT)

The `MarketplaceClient` class methods use an internal type `MarketplaceResult` (defined in `src/core/marketplace/types.ts`) which is **NOT exported** from `src/index.ts`. The exported types are `MarketplaceSkill` and `MarketplaceSearchResult`.

**In API-REFERENCE.md** (line 2301-2323):
- `MarketplaceClient.search()` is documented as returning `Promise<MarketplaceResult[]>`
- `MarketplaceClient.getSkill()` is documented as returning `Promise<MarketplaceResult | null>`

**In CLEO Integration doc** (line 141-142):
- `MarketplaceClient.search` comment says `Promise<MarketplaceResult[]>`
- `MarketplaceClient.getSkill` comment says `Promise<MarketplaceResult | null>`

**Actual source** (`src/core/marketplace/client.ts`):
- `search()` returns `Promise<MarketplaceResult[]>` (using the internal type)
- `getSkill()` returns `Promise<MarketplaceResult | null>`

**The problem**: `MarketplaceResult` is not in the public API (`src/index.ts`). Users cannot import it. The docs reference a type that consumers cannot use. Either:
1. `MarketplaceResult` should be exported from `src/index.ts`, OR
2. The docs should note this is an internal type and describe the shape inline, OR
3. The `MarketplaceClient` methods should be updated to use `MarketplaceSkill` instead

**Additionally**, `MarketplaceResult` and `MarketplaceSkill` have different shapes:
- `MarketplaceResult` has: `name, scopedName, description, author, stars, githubUrl, repoFullName, path, source`
- `MarketplaceSkill` has: `id, name, scopedName, description, author, stars, forks, githubUrl, repoFullName, path, category?, hasContent`

These are structurally different types. `MarketplaceResult` is missing `id`, `forks`, `category`, `hasContent` fields and has a `source` field that `MarketplaceSkill` lacks.

#### Issue 2: `mcp_remove_config` phantom function

The integration doc (Section 3, row 83) maps bash function `mcp_remove_config` to CAAMP's `removeMcpServer`. However, `mcp_remove_config` does not exist in `lib/mcp-config.sh`. The grep returns no matches.

This is a minor documentation error -- the function may have existed previously or may have been planned but not implemented.

#### Issue 3: `MarketplaceAdapter` type not documented

The `MarketplaceClient` constructor accepts `adapters?: MarketplaceAdapter[]` but `MarketplaceAdapter` is neither exported from `src/index.ts` nor documented in the API Reference. The API-REFERENCE.md mentions it in the constructor table but doesn't define the interface.

This is a minor completeness issue -- since `MarketplaceAdapter` is not exported, custom adapters cannot be created by consumers. The default adapters suffice, but the docs should clarify this is internal-only.

---

## Corrections Needed

### Must Fix (blocks accuracy)

1. **API-REFERENCE.md -- MarketplaceClient return types**: The `search()` and `getSkill()` methods reference `MarketplaceResult` which is not an exported type. Options:
   - Add `export type { MarketplaceResult } from "./core/marketplace/types.js"` to `src/index.ts` and document it
   - OR update the API docs to inline the return type shape and note it is not directly importable

2. **CLEO-CAAMP-INTEGRATION.md -- MarketplaceClient method signatures**: Same `MarketplaceResult` issue in the import surface comments (lines 141-142). Must be consistent with whatever fix is applied to the API Reference.

### Should Fix (minor inaccuracies)

3. **CLEO-CAAMP-INTEGRATION.md -- Remove `mcp_remove_config` entry**: Row 83 in the Complete Function List references `mcp_remove_config` from `mcp-config.sh`, but this function does not exist in the source. Remove this row or replace with the actual function name if one handles removal.

### Nice to Have (documentation quality)

4. **API-REFERENCE.md -- `MarketplaceAdapter` type**: Add a note in the MarketplaceClient constructor section that `MarketplaceAdapter` is an internal type and custom adapters are not part of the public API.

5. **CLEO-CAAMP-INTEGRATION.md -- `mcp_backup_external_file` duplicate**: The function appears twice in the Complete Function List (rows 75 and 84). Remove the duplicate entry.

---

## Validation Methodology

- **Source of truth**: `src/index.ts` export statements, cross-referenced with actual TypeScript source files in `src/core/`
- **API-REFERENCE.md**: Read in full (2434 lines), every exported symbol verified against source
- **CLEO-CAAMP-INTEGRATION.md**: Read in full (853 lines), import surface and migration tables verified
- **CLEO bash files**: Spot-checked 4 files via grep for function definitions, compared against integration doc migration tables
- **Signature verification**: 10 key functions compared character-by-character between docs and source
