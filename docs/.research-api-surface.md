# CAAMP API Surface Research

**Date**: 2026-02-11
**Source**: `src/index.ts` (102 lines, all public exports)
**Total Exported Symbols**: 75

---

## 1. Types (`src/types.ts`)

### ConfigFormat

- **Module**: `src/types.ts`
- **Kind**: Type alias
- **Definition**: `"json" | "jsonc" | "yaml" | "toml"`
- **Description**: Supported configuration file formats for agent config files.

### TransportType

- **Module**: `src/types.ts`
- **Kind**: Type alias
- **Definition**: `"stdio" | "sse" | "http"`
- **Description**: MCP server transport protocols.

### SourceType

- **Module**: `src/types.ts`
- **Kind**: Type alias
- **Definition**: `"remote" | "package" | "command" | "github" | "gitlab" | "local"`
- **Description**: Classification of MCP server or skill source inputs.

### Provider

- **Module**: `src/types.ts`
- **Kind**: Interface
- **Description**: Full definition of an AI coding agent provider with paths, config, detection, and capability metadata.
- **Properties**:
  - `id: string` - Unique provider identifier (e.g., "claude-code")
  - `toolName: string` - Human-readable tool name
  - `vendor: string` - Vendor/company name
  - `agentFlag: string` - CLI flag name for this agent
  - `aliases: string[]` - Alternative names for resolution
  - `pathGlobal: string` - Resolved global instructions directory path
  - `pathProject: string` - Project-level instructions relative path
  - `instructFile: string` - Instruction file name (e.g., "CLAUDE.md")
  - `configKey: string` - Dot-notation key for MCP servers in config (e.g., "mcpServers")
  - `configFormat: ConfigFormat` - Format of the config file
  - `configPathGlobal: string` - Resolved global config file path
  - `configPathProject: string | null` - Project config file relative path (null if unsupported)
  - `pathSkills: string` - Resolved global skills directory path
  - `pathProjectSkills: string` - Project skills relative path
  - `detection: DetectionConfig` - Auto-detection configuration
  - `supportedTransports: TransportType[]` - Supported MCP transport types
  - `supportsHeaders: boolean` - Whether provider supports HTTP headers in config
  - `priority: ProviderPriority` - Priority tier ("high" | "medium" | "low")
  - `status: ProviderStatus` - Lifecycle status ("active" | "beta" | "deprecated" | "planned")
  - `agentSkillsCompatible: boolean` - Whether provider supports agent skills

### McpServerConfig

- **Module**: `src/types.ts`
- **Kind**: Interface
- **Description**: Canonical MCP server configuration (transport-agnostic).
- **Properties**:
  - `type?: TransportType` - Transport type
  - `url?: string` - Server URL (for remote/SSE/HTTP transports)
  - `headers?: Record<string, string>` - HTTP headers
  - `command?: string` - Command to run (for stdio transport)
  - `args?: string[]` - Command arguments
  - `env?: Record<string, string>` - Environment variables

### McpServerEntry

- **Module**: `src/types.ts`
- **Kind**: Interface
- **Description**: An MCP server entry as returned by list operations.
- **Properties**:
  - `name: string` - Server name/key
  - `providerId: string` - Provider that owns this config
  - `providerName: string` - Human-readable provider name
  - `scope: "project" | "global"` - Installation scope
  - `configPath: string` - Absolute path to the config file
  - `config: Record<string, unknown>` - Raw config object

### ParsedSource

- **Module**: `src/types.ts`
- **Kind**: Interface
- **Description**: Result of classifying a source string (URL, package, GitHub shorthand, etc.).
- **Properties**:
  - `type: SourceType` - Classified source type
  - `value: string` - Normalized/resolved value
  - `inferredName: string` - Best-guess display name
  - `owner?: string` - GitHub/GitLab repository owner
  - `repo?: string` - GitHub/GitLab repository name
  - `path?: string` - Sub-path within repository
  - `ref?: string` - Git ref (branch/tag)

### SkillMetadata

- **Module**: `src/types.ts`
- **Kind**: Interface
- **Description**: Parsed SKILL.md frontmatter metadata.
- **Properties**:
  - `name: string` - Skill name
  - `description: string` - Skill description
  - `license?: string` - License identifier
  - `compatibility?: string` - Compatibility string
  - `metadata?: Record<string, string>` - Additional key-value metadata
  - `allowedTools?: string[]` - Allowed tool list
  - `version?: string` - Skill version

### SkillEntry

- **Module**: `src/types.ts`
- **Kind**: Interface
- **Description**: A discovered skill with its path and parsed metadata.
- **Properties**:
  - `name: string` - Skill name
  - `scopedName: string` - Scoped name for identification
  - `path: string` - Absolute path to skill directory
  - `metadata: SkillMetadata` - Parsed metadata
  - `source?: string` - Installation source

### LockEntry

- **Module**: `src/types.ts`
- **Kind**: Interface
- **Description**: A tracked installation entry in the lock file.
- **Properties**:
  - `name: string` - Entry name
  - `scopedName: string` - Scoped name
  - `source: string` - Original source string
  - `sourceType: SourceType` - Classified source type
  - `version?: string` - Installed version
  - `installedAt: string` - ISO timestamp of first install
  - `updatedAt?: string` - ISO timestamp of last update
  - `agents: string[]` - Provider IDs this is installed to
  - `canonicalPath: string` - Canonical storage path
  - `isGlobal: boolean` - Whether installed globally
  - `projectDir?: string` - Project directory (if project-scoped)

### CaampLockFile

- **Module**: `src/types.ts`
- **Kind**: Interface
- **Description**: Top-level lock file structure at `~/.agents/.caamp-lock.json`.
- **Properties**:
  - `version: 1` - Lock file schema version (literal 1)
  - `skills: Record<string, LockEntry>` - Tracked skill installations
  - `mcpServers: Record<string, LockEntry>` - Tracked MCP server installations
  - `lastSelectedAgents?: string[]` - Last selected agents for UX persistence

### MarketplaceSkill

- **Module**: `src/types.ts`
- **Kind**: Interface
- **Description**: A skill listing from a marketplace source.
- **Properties**:
  - `id: string` - Unique identifier
  - `name: string` - Skill name
  - `scopedName: string` - Scoped name (e.g., "@author/name")
  - `description: string` - Description text
  - `author: string` - Author name
  - `stars: number` - GitHub star count
  - `forks: number` - GitHub fork count
  - `githubUrl: string` - GitHub repository URL
  - `repoFullName: string` - Full "owner/repo" name
  - `path: string` - Path within repository
  - `category?: string` - Optional category
  - `hasContent: boolean` - Whether content was fetched

### MarketplaceSearchResult

- **Module**: `src/types.ts`
- **Kind**: Interface
- **Description**: Paginated marketplace search response.
- **Properties**:
  - `skills: MarketplaceSkill[]` - Array of matching skills
  - `total: number` - Total number of results
  - `limit: number` - Page size
  - `offset: number` - Current offset

### AuditSeverity

- **Module**: `src/types.ts`
- **Kind**: Type alias
- **Definition**: `"critical" | "high" | "medium" | "low" | "info"`
- **Description**: Severity levels for security audit findings.

### AuditRule

- **Module**: `src/types.ts`
- **Kind**: Interface
- **Description**: A security scanning rule definition.
- **Properties**:
  - `id: string` - Rule identifier
  - `name: string` - Rule name
  - `description: string` - What the rule detects
  - `severity: AuditSeverity` - Severity level
  - `category: string` - Rule category
  - `pattern: RegExp` - Regex pattern to match against

### AuditFinding

- **Module**: `src/types.ts`
- **Kind**: Interface
- **Description**: A single security finding within a file.
- **Properties**:
  - `rule: AuditRule` - The matched rule
  - `line: number` - Line number (1-based)
  - `column: number` - Column number (1-based)
  - `match: string` - Matched text
  - `context: string` - Trimmed line content for context

### AuditResult

- **Module**: `src/types.ts`
- **Kind**: Interface
- **Description**: Aggregated audit result for a single file.
- **Properties**:
  - `file: string` - File path
  - `findings: AuditFinding[]` - All findings
  - `score: number` - Security score (100 = clean, 0 = dangerous)
  - `passed: boolean` - True if no critical/high findings

### InjectionStatus

- **Module**: `src/types.ts`
- **Kind**: Type alias
- **Definition**: `"current" | "outdated" | "missing" | "none"`
- **Description**: Status of a CAAMP injection block in an instruction file.

### InjectionCheckResult

- **Module**: `src/types.ts`
- **Kind**: Interface
- **Description**: Result of checking injection status for one file.
- **Properties**:
  - `file: string` - File path checked
  - `provider: string` - Provider ID
  - `status: InjectionStatus` - Current injection status
  - `fileExists: boolean` - Whether the file exists on disk

### GlobalOptions

- **Module**: `src/types.ts`
- **Kind**: Interface
- **Description**: CLI-level global options passed through commands.
- **Properties**:
  - `agent?: string[]` - Target agent IDs
  - `global?: boolean` - Use global scope
  - `yes?: boolean` - Skip confirmation prompts
  - `all?: boolean` - Target all providers
  - `json?: boolean` - Output as JSON
  - `dryRun?: boolean` - Preview without writing

---

## 2. Registry (`src/core/registry/providers.ts`)

### getAllProviders

- **Module**: `src/core/registry/providers.ts`
- **Signature**: `function getAllProviders(): Provider[]`
- **Description**: Returns all registered providers from `providers/registry.json`, with platform-specific paths resolved.
- **Parameters**: None
- **Returns**: `Provider[]` - Array of all provider definitions.

### getProvider

- **Module**: `src/core/registry/providers.ts`
- **Signature**: `function getProvider(idOrAlias: string): Provider | undefined`
- **Description**: Looks up a provider by its ID or any of its aliases.
- **Parameters**:
  - `idOrAlias: string` - Provider ID or alias to resolve
- **Returns**: `Provider | undefined` - The matching provider, or undefined if not found.

### resolveAlias

- **Module**: `src/core/registry/providers.ts`
- **Signature**: `function resolveAlias(idOrAlias: string): string`
- **Description**: Resolves an alias to its canonical provider ID. Returns the input unchanged if not an alias.
- **Parameters**:
  - `idOrAlias: string` - Provider ID or alias
- **Returns**: `string` - Canonical provider ID.

### getProvidersByPriority

- **Module**: `src/core/registry/providers.ts`
- **Signature**: `function getProvidersByPriority(priority: ProviderPriority): Provider[]`
- **Description**: Filters providers by priority tier.
- **Parameters**:
  - `priority: ProviderPriority` - Priority level ("high" | "medium" | "low")
- **Returns**: `Provider[]` - Providers matching the priority.

### getProvidersByStatus

- **Module**: `src/core/registry/providers.ts`
- **Signature**: `function getProvidersByStatus(status: ProviderStatus): Provider[]`
- **Description**: Filters providers by lifecycle status.
- **Parameters**:
  - `status: ProviderStatus` - Status ("active" | "beta" | "deprecated" | "planned")
- **Returns**: `Provider[]` - Providers matching the status.

### getProvidersByInstructFile

- **Module**: `src/core/registry/providers.ts`
- **Signature**: `function getProvidersByInstructFile(file: string): Provider[]`
- **Description**: Gets all providers that use a specific instruction file name.
- **Parameters**:
  - `file: string` - Instruction file name (e.g., "CLAUDE.md")
- **Returns**: `Provider[]` - Providers using that instruction file.

### getInstructionFiles

- **Module**: `src/core/registry/providers.ts`
- **Signature**: `function getInstructionFiles(): string[]`
- **Description**: Returns all unique instruction file names across all providers.
- **Parameters**: None
- **Returns**: `string[]` - Deduplicated array of instruction file names.

### getProviderCount

- **Module**: `src/core/registry/providers.ts`
- **Signature**: `function getProviderCount(): number`
- **Description**: Returns the total number of registered providers.
- **Parameters**: None
- **Returns**: `number` - Provider count.

### getRegistryVersion

- **Module**: `src/core/registry/providers.ts`
- **Signature**: `function getRegistryVersion(): string`
- **Description**: Returns the version string from `providers/registry.json`.
- **Parameters**: None
- **Returns**: `string` - Registry version.

---

## 3. Detection (`src/core/registry/detection.ts`)

### DetectionResult

- **Module**: `src/core/registry/detection.ts`
- **Kind**: Interface (exported type)
- **Description**: Result of detecting whether a provider is installed.
- **Properties**:
  - `provider: Provider` - The provider that was checked
  - `installed: boolean` - Whether the provider was detected
  - `methods: string[]` - Detection methods that matched (e.g., "binary", "directory")
  - `projectDetected: boolean` - Whether project-level config exists

### detectProvider

- **Module**: `src/core/registry/detection.ts`
- **Signature**: `function detectProvider(provider: Provider): DetectionResult`
- **Description**: Detects if a single provider is installed by checking binaries, directories, app bundles, and flatpak packages.
- **Parameters**:
  - `provider: Provider` - Provider to check
- **Returns**: `DetectionResult` - Detection result with matched methods.

### detectAllProviders

- **Module**: `src/core/registry/detection.ts`
- **Signature**: `function detectAllProviders(): DetectionResult[]`
- **Description**: Runs detection for all registered providers.
- **Parameters**: None
- **Returns**: `DetectionResult[]` - Detection results for every provider.

### getInstalledProviders

- **Module**: `src/core/registry/detection.ts`
- **Signature**: `function getInstalledProviders(): Provider[]`
- **Description**: Returns only providers detected as installed on the system.
- **Parameters**: None
- **Returns**: `Provider[]` - Installed providers.

### detectProjectProviders

- **Module**: `src/core/registry/detection.ts`
- **Signature**: `function detectProjectProviders(projectDir: string): DetectionResult[]`
- **Description**: Detects all providers and also checks for project-level configuration in the given directory.
- **Parameters**:
  - `projectDir: string` - Directory to check for project-level configs
- **Returns**: `DetectionResult[]` - Detection results with `projectDetected` populated.

---

## 4. Source Parsing (`src/core/sources/parser.ts`)

### parseSource

- **Module**: `src/core/sources/parser.ts`
- **Signature**: `function parseSource(input: string): ParsedSource`
- **Description**: Classifies a source string into one of the supported source types: GitHub URL, GitLab URL, HTTP remote, local path, GitHub shorthand (owner/repo), npm package, or shell command.
- **Parameters**:
  - `input: string` - Raw source string (URL, package name, path, or command)
- **Returns**: `ParsedSource` - Classified source with inferred name and optional owner/repo/ref/path.

### isMarketplaceScoped

- **Module**: `src/core/sources/parser.ts`
- **Signature**: `function isMarketplaceScoped(input: string): boolean`
- **Description**: Checks if a source string looks like a marketplace scoped name (e.g., `@author/name`).
- **Parameters**:
  - `input: string` - String to test
- **Returns**: `boolean` - True if it matches `@scope/name` pattern.

---

## 5. Skills Install (`src/core/skills/installer.ts`)

### SkillInstallResult

- **Module**: `src/core/skills/installer.ts`
- **Kind**: Interface (exported type)
- **Description**: Result of a skill installation operation.
- **Properties**:
  - `name: string` - Skill name
  - `canonicalPath: string` - Path to canonical copy at `~/.agents/skills/<name>/`
  - `linkedAgents: string[]` - Provider IDs successfully linked
  - `errors: string[]` - Error messages from failed links
  - `success: boolean` - True if at least one agent was linked

### installSkill

- **Module**: `src/core/skills/installer.ts`
- **Signature**: `async function installSkill(sourcePath: string, skillName: string, providers: Provider[], isGlobal: boolean, projectDir?: string): Promise<SkillInstallResult>`
- **Description**: Installs a skill from a local path: copies to the canonical location (`~/.agents/skills/<name>/`) and creates symlinks in each target provider's skills directory.
- **Parameters**:
  - `sourcePath: string` - Local directory containing SKILL.md
  - `skillName: string` - Name for the skill
  - `providers: Provider[]` - Target providers to link
  - `isGlobal: boolean` - Whether to use global or project skill paths
  - `projectDir?: string` - Project directory (defaults to cwd)
- **Returns**: `Promise<SkillInstallResult>` - Installation result with linked agents and errors.

### removeSkill

- **Module**: `src/core/skills/installer.ts`
- **Signature**: `async function removeSkill(skillName: string, providers: Provider[], isGlobal: boolean, projectDir?: string): Promise<{ removed: string[]; errors: string[] }>`
- **Description**: Removes a skill's symlinks from all provider skill directories and deletes the canonical copy.
- **Parameters**:
  - `skillName: string` - Skill to remove
  - `providers: Provider[]` - Providers to unlink from
  - `isGlobal: boolean` - Whether to use global or project skill paths
  - `projectDir?: string` - Project directory (defaults to cwd)
- **Returns**: `Promise<{ removed: string[]; errors: string[] }>` - Provider IDs unlinked and any errors.

### listCanonicalSkills

- **Module**: `src/core/skills/installer.ts`
- **Signature**: `async function listCanonicalSkills(): Promise<string[]>`
- **Description**: Lists all skill names installed in the canonical directory (`~/.agents/skills/`).
- **Parameters**: None
- **Returns**: `Promise<string[]>` - Array of skill directory names.

---

## 6. Skills Discovery (`src/core/skills/discovery.ts`)

### parseSkillFile

- **Module**: `src/core/skills/discovery.ts`
- **Signature**: `async function parseSkillFile(filePath: string): Promise<SkillMetadata | null>`
- **Description**: Reads a SKILL.md file and parses its YAML frontmatter into a SkillMetadata object. Returns null if the file lacks required `name` or `description` fields.
- **Parameters**:
  - `filePath: string` - Absolute path to a SKILL.md file
- **Returns**: `Promise<SkillMetadata | null>` - Parsed metadata or null on failure.

### discoverSkill

- **Module**: `src/core/skills/discovery.ts`
- **Signature**: `async function discoverSkill(skillDir: string): Promise<SkillEntry | null>`
- **Description**: Discovers a skill at a given directory by looking for and parsing `SKILL.md` inside it.
- **Parameters**:
  - `skillDir: string` - Directory that should contain SKILL.md
- **Returns**: `Promise<SkillEntry | null>` - Discovered skill entry or null if no valid SKILL.md found.

### discoverSkills

- **Module**: `src/core/skills/discovery.ts`
- **Signature**: `async function discoverSkills(rootDir: string): Promise<SkillEntry[]>`
- **Description**: Scans a root directory for subdirectories containing SKILL.md files and returns all discovered skills.
- **Parameters**:
  - `rootDir: string` - Directory to scan (each child directory is checked)
- **Returns**: `Promise<SkillEntry[]>` - Array of discovered skills.

---

## 7. Skills Validation (`src/core/skills/validator.ts`)

### ValidationIssue

- **Module**: `src/core/skills/validator.ts`
- **Kind**: Interface (exported type)
- **Description**: A single validation issue found during SKILL.md validation.
- **Properties**:
  - `level: "error" | "warning"` - Severity level
  - `field: string` - Which field has the issue (e.g., "name", "description", "body", "frontmatter")
  - `message: string` - Human-readable issue description

### ValidationResult

- **Module**: `src/core/skills/validator.ts`
- **Kind**: Interface (exported type)
- **Description**: Complete validation result for a SKILL.md file.
- **Properties**:
  - `valid: boolean` - True if no errors (warnings are OK)
  - `issues: ValidationIssue[]` - All found issues
  - `metadata: Record<string, unknown> | null` - Parsed frontmatter (null on parse failure)

### validateSkill

- **Module**: `src/core/skills/validator.ts`
- **Signature**: `async function validateSkill(filePath: string): Promise<ValidationResult>`
- **Description**: Validates a SKILL.md file against the Agent Skills standard. Checks for required frontmatter fields (name, description), name format/length/reserved words, description length, body content, and XSS patterns.
- **Parameters**:
  - `filePath: string` - Path to SKILL.md file
- **Returns**: `Promise<ValidationResult>` - Validation result with issues and parsed metadata.

---

## 8. Skills Audit (`src/core/skills/audit/scanner.ts`)

### scanFile

- **Module**: `src/core/skills/audit/scanner.ts`
- **Signature**: `async function scanFile(filePath: string, rules?: AuditRule[]): Promise<AuditResult>`
- **Description**: Scans a single file against security rules (46+ rules by default). Returns findings with line-level precision and a security score.
- **Parameters**:
  - `filePath: string` - File to scan
  - `rules?: AuditRule[]` - Custom rules (defaults to built-in AUDIT_RULES)
- **Returns**: `Promise<AuditResult>` - Scan result with findings, score, and pass/fail.

### scanDirectory

- **Module**: `src/core/skills/audit/scanner.ts`
- **Signature**: `async function scanDirectory(dirPath: string): Promise<AuditResult[]>`
- **Description**: Scans a directory of skills (each subdirectory's SKILL.md) against security rules.
- **Parameters**:
  - `dirPath: string` - Root directory containing skill subdirectories
- **Returns**: `Promise<AuditResult[]>` - Array of audit results, one per scanned SKILL.md.

### toSarif

- **Module**: `src/core/skills/audit/scanner.ts`
- **Signature**: `function toSarif(results: AuditResult[]): object`
- **Description**: Converts audit results into SARIF 2.1.0 format (Static Analysis Results Interchange Format) for integration with CI/CD tools.
- **Parameters**:
  - `results: AuditResult[]` - Audit results to convert
- **Returns**: `object` - SARIF-formatted object.

---

## 9. Skills Lock (`src/core/skills/lock.ts`)

### recordSkillInstall

- **Module**: `src/core/skills/lock.ts`
- **Signature**: `async function recordSkillInstall(skillName: string, scopedName: string, source: string, sourceType: SourceType, agents: string[], canonicalPath: string, isGlobal: boolean, projectDir?: string, version?: string): Promise<void>`
- **Description**: Records a skill installation in the shared lock file (`~/.agents/.caamp-lock.json`). Merges agent lists on re-install and preserves the original `installedAt` timestamp.
- **Parameters**:
  - `skillName: string` - Skill name key
  - `scopedName: string` - Scoped name
  - `source: string` - Original source string
  - `sourceType: SourceType` - Classified source type
  - `agents: string[]` - Provider IDs linked to
  - `canonicalPath: string` - Canonical storage path
  - `isGlobal: boolean` - Whether installed globally
  - `projectDir?: string` - Project directory (if project-scoped)
  - `version?: string` - Installed version
- **Returns**: `Promise<void>`

### removeSkillFromLock

- **Module**: `src/core/skills/lock.ts`
- **Signature**: `async function removeSkillFromLock(skillName: string): Promise<boolean>`
- **Description**: Removes a skill entry from the lock file.
- **Parameters**:
  - `skillName: string` - Skill name to remove
- **Returns**: `Promise<boolean>` - True if the entry existed and was removed.

### getTrackedSkills

- **Module**: `src/core/skills/lock.ts`
- **Signature**: `async function getTrackedSkills(): Promise<Record<string, LockEntry>>`
- **Description**: Returns all tracked skill installations from the lock file.
- **Parameters**: None
- **Returns**: `Promise<Record<string, LockEntry>>` - Map of skill name to lock entry.

### checkSkillUpdate

- **Module**: `src/core/skills/lock.ts`
- **Signature**: `async function checkSkillUpdate(skillName: string): Promise<{ hasUpdate: boolean; currentVersion?: string; latestVersion?: string }>`
- **Description**: Checks if a skill has updates available. Currently returns `hasUpdate: false` (network check not yet implemented).
- **Parameters**:
  - `skillName: string` - Skill name to check
- **Returns**: `Promise<{ hasUpdate: boolean; currentVersion?: string; latestVersion?: string }>` - Update status.

---

## 10. MCP Install (`src/core/mcp/installer.ts`)

### InstallResult

- **Module**: `src/core/mcp/installer.ts`
- **Kind**: Interface (exported type)
- **Description**: Result of installing an MCP server config to a provider.
- **Properties**:
  - `provider: Provider` - Target provider
  - `scope: "project" | "global"` - Installation scope
  - `configPath: string` - Path where config was written
  - `success: boolean` - Whether the write succeeded
  - `error?: string` - Error message on failure

### installMcpServer

- **Module**: `src/core/mcp/installer.ts`
- **Signature**: `async function installMcpServer(provider: Provider, serverName: string, config: McpServerConfig, scope?: "project" | "global", projectDir?: string): Promise<InstallResult>`
- **Description**: Installs an MCP server configuration for a single provider, applying format-specific transforms.
- **Parameters**:
  - `provider: Provider` - Target provider
  - `serverName: string` - Server name/key
  - `config: McpServerConfig` - Canonical server configuration
  - `scope?: "project" | "global"` - Installation scope (default: "project")
  - `projectDir?: string` - Project directory (defaults to cwd)
- **Returns**: `Promise<InstallResult>` - Installation result.

### installMcpServerToAll

- **Module**: `src/core/mcp/installer.ts`
- **Signature**: `async function installMcpServerToAll(providers: Provider[], serverName: string, config: McpServerConfig, scope?: "project" | "global", projectDir?: string): Promise<InstallResult[]>`
- **Description**: Installs an MCP server configuration across multiple providers sequentially.
- **Parameters**:
  - `providers: Provider[]` - Target providers
  - `serverName: string` - Server name/key
  - `config: McpServerConfig` - Canonical server configuration
  - `scope?: "project" | "global"` - Installation scope (default: "project")
  - `projectDir?: string` - Project directory (defaults to cwd)
- **Returns**: `Promise<InstallResult[]>` - Array of installation results.

### buildServerConfig

- **Module**: `src/core/mcp/installer.ts`
- **Signature**: `function buildServerConfig(source: { type: string; value: string }, transport?: string, headers?: Record<string, string>): McpServerConfig`
- **Description**: Builds a canonical MCP server config from a parsed source. Remote sources become HTTP/SSE configs, packages become `npx` stdio configs, and commands are split into command + args.
- **Parameters**:
  - `source: { type: string; value: string }` - Parsed source with type and value
  - `transport?: string` - Override transport type
  - `headers?: Record<string, string>` - HTTP headers for remote servers
- **Returns**: `McpServerConfig` - Canonical config object.

---

## 11. MCP Transforms (`src/core/mcp/transforms.ts`)

### getTransform

- **Module**: `src/core/mcp/transforms.ts`
- **Signature**: `function getTransform(providerId: string): ((name: string, config: McpServerConfig) => unknown) | undefined`
- **Description**: Returns the transform function for a provider, or undefined for providers that use the canonical format directly. Supports transforms for: goose, zed, opencode, codex, cursor.
- **Parameters**:
  - `providerId: string` - Provider ID to look up
- **Returns**: `((name: string, config: McpServerConfig) => unknown) | undefined` - Transform function or undefined.

---

## 12. MCP Reader (`src/core/mcp/reader.ts`)

### resolveConfigPath

- **Module**: `src/core/mcp/reader.ts`
- **Signature**: `function resolveConfigPath(provider: Provider, scope: "project" | "global", projectDir?: string): string | null`
- **Description**: Resolves the absolute config file path for a provider and scope. Returns null if the provider doesn't support project-level config.
- **Parameters**:
  - `provider: Provider` - Provider definition
  - `scope: "project" | "global"` - Scope to resolve
  - `projectDir?: string` - Project directory (defaults to cwd)
- **Returns**: `string | null` - Absolute path or null.

### listMcpServers

- **Module**: `src/core/mcp/reader.ts`
- **Signature**: `async function listMcpServers(provider: Provider, scope: "project" | "global", projectDir?: string): Promise<McpServerEntry[]>`
- **Description**: Lists all MCP servers configured for a single provider by reading its config file.
- **Parameters**:
  - `provider: Provider` - Provider to query
  - `scope: "project" | "global"` - Which config to read
  - `projectDir?: string` - Project directory (defaults to cwd)
- **Returns**: `Promise<McpServerEntry[]>` - Array of server entries.

### listAllMcpServers

- **Module**: `src/core/mcp/reader.ts`
- **Signature**: `async function listAllMcpServers(providers: Provider[], scope: "project" | "global", projectDir?: string): Promise<McpServerEntry[]>`
- **Description**: Lists MCP servers across multiple providers, deduplicating by config path to avoid counting shared configs twice.
- **Parameters**:
  - `providers: Provider[]` - Providers to query
  - `scope: "project" | "global"` - Which configs to read
  - `projectDir?: string` - Project directory (defaults to cwd)
- **Returns**: `Promise<McpServerEntry[]>` - Aggregated, deduplicated server entries.

### removeMcpServer

- **Module**: `src/core/mcp/reader.ts`
- **Signature**: `async function removeMcpServer(provider: Provider, serverName: string, scope: "project" | "global", projectDir?: string): Promise<boolean>`
- **Description**: Removes an MCP server entry from a provider's config file.
- **Parameters**:
  - `provider: Provider` - Provider to modify
  - `serverName: string` - Server name/key to remove
  - `scope: "project" | "global"` - Which config to modify
  - `projectDir?: string` - Project directory (defaults to cwd)
- **Returns**: `Promise<boolean>` - True if the entry was found and removed.

---

## 13. MCP Lock (`src/core/mcp/lock.ts`)

### readLockFile

- **Module**: `src/core/mcp/lock.ts`
- **Signature**: `async function readLockFile(): Promise<CaampLockFile>`
- **Description**: Reads the shared lock file at `~/.agents/.caamp-lock.json`. Returns a default empty structure if the file doesn't exist or is corrupted.
- **Parameters**: None
- **Returns**: `Promise<CaampLockFile>` - Parsed lock file contents.

### recordMcpInstall

- **Module**: `src/core/mcp/lock.ts`
- **Signature**: `async function recordMcpInstall(serverName: string, source: string, sourceType: SourceType, agents: string[], isGlobal: boolean): Promise<void>`
- **Description**: Records an MCP server installation in the lock file. Merges agent lists on re-install.
- **Parameters**:
  - `serverName: string` - Server name/key
  - `source: string` - Original source string
  - `sourceType: SourceType` - Classified source type
  - `agents: string[]` - Provider IDs installed to
  - `isGlobal: boolean` - Whether installed globally
- **Returns**: `Promise<void>`

### removeMcpFromLock

- **Module**: `src/core/mcp/lock.ts`
- **Signature**: `async function removeMcpFromLock(serverName: string): Promise<boolean>`
- **Description**: Removes an MCP server entry from the lock file.
- **Parameters**:
  - `serverName: string` - Server name to remove
- **Returns**: `Promise<boolean>` - True if the entry existed and was removed.

### getTrackedMcpServers

- **Module**: `src/core/mcp/lock.ts`
- **Signature**: `async function getTrackedMcpServers(): Promise<Record<string, LockEntry>>`
- **Description**: Returns all tracked MCP server installations from the lock file.
- **Parameters**: None
- **Returns**: `Promise<Record<string, LockEntry>>` - Map of server name to lock entry.

### saveLastSelectedAgents

- **Module**: `src/core/mcp/lock.ts`
- **Signature**: `async function saveLastSelectedAgents(agents: string[]): Promise<void>`
- **Description**: Persists the last selected agent list for UX continuity.
- **Parameters**:
  - `agents: string[]` - Agent IDs to save
- **Returns**: `Promise<void>`

### getLastSelectedAgents

- **Module**: `src/core/mcp/lock.ts`
- **Signature**: `async function getLastSelectedAgents(): Promise<string[] | undefined>`
- **Description**: Retrieves the last selected agent list.
- **Parameters**: None
- **Returns**: `Promise<string[] | undefined>` - Saved agent IDs or undefined if none saved.

---

## 14. Formats (`src/core/formats/index.ts` + `src/core/formats/utils.ts`)

### readConfig

- **Module**: `src/core/formats/index.ts`
- **Signature**: `async function readConfig(filePath: string, format: ConfigFormat): Promise<Record<string, unknown>>`
- **Description**: Reads and parses a config file in the specified format (JSON, JSONC, YAML, or TOML).
- **Parameters**:
  - `filePath: string` - Path to the config file
  - `format: ConfigFormat` - File format
- **Returns**: `Promise<Record<string, unknown>>` - Parsed config object.

### writeConfig

- **Module**: `src/core/formats/index.ts`
- **Signature**: `async function writeConfig(filePath: string, format: ConfigFormat, key: string, serverName: string, serverConfig: unknown): Promise<void>`
- **Description**: Writes a server entry to a config file, preserving existing content. Uses dot-notation key path to set the entry.
- **Parameters**:
  - `filePath: string` - Path to the config file
  - `format: ConfigFormat` - File format
  - `key: string` - Dot-notation key path (e.g., "mcpServers")
  - `serverName: string` - Server name/key
  - `serverConfig: unknown` - Server config object to write
- **Returns**: `Promise<void>`

### removeConfig

- **Module**: `src/core/formats/index.ts`
- **Signature**: `async function removeConfig(filePath: string, format: ConfigFormat, key: string, serverName: string): Promise<boolean>`
- **Description**: Removes a server entry from a config file.
- **Parameters**:
  - `filePath: string` - Path to the config file
  - `format: ConfigFormat` - File format
  - `key: string` - Dot-notation key path
  - `serverName: string` - Server name/key to remove
- **Returns**: `Promise<boolean>` - True if the entry was found and removed.

### getNestedValue

- **Module**: `src/core/formats/utils.ts`
- **Signature**: `function getNestedValue(obj: Record<string, unknown>, keyPath: string): unknown`
- **Description**: Gets a value from a nested object using dot-notation key path.
- **Parameters**:
  - `obj: Record<string, unknown>` - Object to traverse
  - `keyPath: string` - Dot-separated path (e.g., "a.b.c")
- **Returns**: `unknown` - The value at the path, or undefined.

### deepMerge

- **Module**: `src/core/formats/utils.ts`
- **Signature**: `function deepMerge(target: Record<string, unknown>, source: Record<string, unknown>): Record<string, unknown>`
- **Description**: Deep merges two objects. Source values win on conflict. Arrays are replaced, not merged.
- **Parameters**:
  - `target: Record<string, unknown>` - Base object
  - `source: Record<string, unknown>` - Object to merge in (wins on conflict)
- **Returns**: `Record<string, unknown>` - New merged object.

### ensureDir

- **Module**: `src/core/formats/utils.ts`
- **Signature**: `async function ensureDir(filePath: string): Promise<void>`
- **Description**: Ensures the parent directory of a file path exists, creating it recursively if needed.
- **Parameters**:
  - `filePath: string` - File path whose parent directory should exist
- **Returns**: `Promise<void>`

---

## 15. Instructions (`src/core/instructions/injector.ts` + `src/core/instructions/templates.ts`)

### inject

- **Module**: `src/core/instructions/injector.ts`
- **Signature**: `async function inject(filePath: string, content: string): Promise<"created" | "added" | "updated">`
- **Description**: Injects content between CAAMP markers (`<!-- CAAMP:START -->` / `<!-- CAAMP:END -->`) in an instruction file. Creates the file if missing, prepends block if no markers exist, or replaces existing block.
- **Parameters**:
  - `filePath: string` - Path to the instruction file
  - `content: string` - Content to inject between markers
- **Returns**: `Promise<"created" | "added" | "updated">` - Action taken.

### checkInjection

- **Module**: `src/core/instructions/injector.ts`
- **Signature**: `async function checkInjection(filePath: string, expectedContent?: string): Promise<InjectionStatus>`
- **Description**: Checks if a file has a CAAMP injection block and whether its content is current.
- **Parameters**:
  - `filePath: string` - File to check
  - `expectedContent?: string` - Expected content to compare against (if omitted, any block is "current")
- **Returns**: `Promise<InjectionStatus>` - Status: "current", "outdated", "missing" (file doesn't exist), or "none" (file exists but no markers).

### removeInjection

- **Module**: `src/core/instructions/injector.ts`
- **Signature**: `async function removeInjection(filePath: string): Promise<boolean>`
- **Description**: Removes the CAAMP injection block from a file. Deletes the file entirely if it would be empty after removal.
- **Parameters**:
  - `filePath: string` - File to clean
- **Returns**: `Promise<boolean>` - True if a block was found and removed.

### checkAllInjections

- **Module**: `src/core/instructions/injector.ts`
- **Signature**: `async function checkAllInjections(providers: Provider[], projectDir: string, scope: "project" | "global", expectedContent?: string): Promise<InjectionCheckResult[]>`
- **Description**: Checks injection status across all providers' instruction files, deduplicating by file path.
- **Parameters**:
  - `providers: Provider[]` - Providers to check
  - `projectDir: string` - Project directory
  - `scope: "project" | "global"` - Which instruction files to check
  - `expectedContent?: string` - Expected content for comparison
- **Returns**: `Promise<InjectionCheckResult[]>` - Array of status results.

### injectAll

- **Module**: `src/core/instructions/injector.ts`
- **Signature**: `async function injectAll(providers: Provider[], projectDir: string, scope: "project" | "global", content: string): Promise<Map<string, "created" | "added" | "updated">>`
- **Description**: Injects content into all providers' instruction files, deduplicating by file path.
- **Parameters**:
  - `providers: Provider[]` - Target providers
  - `projectDir: string` - Project directory
  - `scope: "project" | "global"` - Which instruction files to modify
  - `content: string` - Content to inject
- **Returns**: `Promise<Map<string, "created" | "added" | "updated">>` - Map of file path to action taken.

### generateInjectionContent

- **Module**: `src/core/instructions/templates.ts`
- **Signature**: `function generateInjectionContent(options?: { mcpServerName?: string; customContent?: string }): string`
- **Description**: Generates standard CAAMP injection block content with optional MCP server and custom content sections.
- **Parameters**:
  - `options?.mcpServerName?: string` - MCP server name to include
  - `options?.customContent?: string` - Additional custom content
- **Returns**: `string` - Markdown content for injection.

### groupByInstructFile

- **Module**: `src/core/instructions/templates.ts`
- **Signature**: `function groupByInstructFile(providers: Provider[]): Map<string, Provider[]>`
- **Description**: Groups providers by their instruction file name for efficient batch operations.
- **Parameters**:
  - `providers: Provider[]` - Providers to group
- **Returns**: `Map<string, Provider[]>` - Map of instruction file name to providers sharing it.

---

## 16. Marketplace (`src/core/marketplace/client.ts`)

### MarketplaceClient

- **Module**: `src/core/marketplace/client.ts`
- **Kind**: Class
- **Description**: Unified marketplace client that aggregates results from multiple marketplace adapters (SkillsMP, SkillsSh), deduplicates by scoped name, and sorts by star count.

#### Constructor

- **Signature**: `constructor(adapters?: MarketplaceAdapter[])`
- **Parameters**:
  - `adapters?: MarketplaceAdapter[]` - Custom adapters (defaults to SkillsMPAdapter + SkillsShAdapter)

#### search

- **Signature**: `async search(query: string, limit?: number): Promise<MarketplaceResult[]>`
- **Description**: Searches all marketplace adapters in parallel, deduplicates by `scopedName` (keeping higher star count), and returns results sorted by stars descending.
- **Parameters**:
  - `query: string` - Search query
  - `limit?: number` - Maximum results (default: 20)
- **Returns**: `Promise<MarketplaceResult[]>` - Deduplicated, sorted results.

#### getSkill

- **Signature**: `async getSkill(scopedName: string): Promise<MarketplaceResult | null>`
- **Description**: Gets a specific skill by scoped name, trying each adapter in order until one returns a result.
- **Parameters**:
  - `scopedName: string` - Scoped skill name (e.g., "@author/name")
- **Returns**: `Promise<MarketplaceResult | null>` - Skill details or null if not found.

---

## Summary

### Export Count by Domain

| Domain | Types | Functions | Classes | Total |
|--------|-------|-----------|---------|-------|
| Types (src/types.ts) | 22 | 0 | 0 | 22 |
| Registry | 0 | 8 | 0 | 8 |
| Detection | 1 | 4 | 0 | 5 |
| Source Parsing | 0 | 2 | 0 | 2 |
| Skills Install | 1 | 3 | 0 | 4 |
| Skills Discovery | 0 | 3 | 0 | 3 |
| Skills Validation | 2 | 1 | 0 | 3 |
| Skills Audit | 0 | 3 | 0 | 3 |
| Skills Lock | 0 | 4 | 0 | 4 |
| MCP Install | 1 | 3 | 0 | 4 |
| MCP Transforms | 0 | 1 | 0 | 1 |
| MCP Reader | 0 | 4 | 0 | 4 |
| MCP Lock | 0 | 6 | 0 | 6 |
| Formats | 0 | 6 | 0 | 6 |
| Instructions | 0 | 7 | 0 | 7 |
| Marketplace | 0 | 0 | 1 | 1 |
| **TOTAL** | **27** | **55** | **1** | **83** |

**Note on count**: The index.ts file exports 75 named symbols. The additional 8 come from the MarketplaceClient class methods (constructor, search, getSkill) counted separately, and several internal-only type exports (DetectionConfig, DetectionMethod, ProviderPriority, ProviderStatus) that are used in the Provider interface but not directly re-exported from index.ts. The 75 directly exported symbols from `src/index.ts` break down as: 22 types from types.ts + 4 types from core modules + 49 functions/class exports = 75.
